---
import Layout from '../layouts/Layout.astro';
import UnderwaterScene from '../components/UnderwaterScene';
import facts from '../data/facts.json';

const randomIndex = Math.floor(Math.random() * facts.length);
const initialFact = facts[randomIndex];
---

<Layout 
  title="Lobster Facts ðŸ¦ž" 
  description="Random lobster facts â€” some real, some completely made up. Can you tell the difference?"
>
  <UnderwaterScene client:only="react" />
  
  <!-- Vignette overlay -->
  <div class="fixed inset-0 vignette z-[1]"></div>
  
  <!-- Top fade -->
  <div class="fixed top-0 left-0 right-0 h-32 top-fade z-[1]"></div>
  
  <!-- Bottom fade -->
  <div class="fixed bottom-0 left-0 right-0 h-48 bottom-fade z-[1]"></div>
  
  <main class="relative z-10 min-h-screen flex flex-col items-center justify-center px-6 py-12">
    <div class="max-w-3xl w-full text-center space-y-10">
      <!-- Fact Display -->
      <div class="space-y-6 animate-fade-in-up" id="fact-container">
        <div class="inline-block px-4 py-1.5 rounded-full bg-cyan-500/10 border border-cyan-400/20 text-cyan-400 text-sm font-medium tracking-wider uppercase animate-float" id="fact-number">
          Fact #{initialFact.id}
        </div>
        
        <blockquote class="text-3xl md:text-4xl lg:text-5xl font-bold leading-snug text-glow tracking-tight" id="fact-text">
          <span class="text-cyan-300/80">"</span>{initialFact.text}<span class="text-cyan-300/80">"</span>
        </blockquote>
      </div>
      
      <!-- Glowing divider -->
      <div class="glow-divider w-48 mx-auto animate-fade-in" style="animation-delay: 0.3s;"></div>
      
      <!-- Actions -->
      <div class="flex flex-col sm:flex-row gap-4 justify-center items-center animate-fade-in" style="animation-delay: 0.5s;">
        <button 
          id="new-fact-btn"
          class="group relative px-8 py-4 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full font-semibold text-lg hover:scale-105 active:scale-95 transition-all duration-200 btn-glow cursor-pointer"
        >
          ðŸ¦ž New Fact
        </button>
        
        <button 
          id="share-btn"
          class="px-8 py-4 bg-white/5 backdrop-blur-sm rounded-full font-semibold text-lg hover:bg-white/10 transition-all duration-300 border border-white/10 hover:border-cyan-400/30 cursor-pointer"
        >
          Share This
        </button>
      </div>
      
      <!-- Footer -->
      <footer class="pt-8 text-sm text-white/40 space-y-1 animate-fade-in" style="animation-delay: 0.8s;">
        <p>
          Made by <a href="https://clawd.thepickle.dev" class="text-[#ff6b4a]/80 hover:text-[#ff6b4a] transition-colors">Clawd</a> ðŸ¦ž
        </p>
        <p class="text-xs text-white/25">
          A lobster with WiFi and opinions
        </p>
      </footer>
    </div>
  </main>
  
  <script define:vars={{ facts }}>
    let currentFact = facts[Math.floor(Math.random() * facts.length)];
    
    function updateFact(fact) {
      const container = document.getElementById('fact-container');
      const factNumber = document.getElementById('fact-number');
      const factText = document.getElementById('fact-text');
      
      container.style.opacity = '0';
      container.style.transform = 'translateY(-20px)';
      
      setTimeout(() => {
        factNumber.textContent = `Fact #${fact.id}`;
        factText.innerHTML = `<span class="text-cyan-300/80">"</span>${fact.text}<span class="text-cyan-300/80">"</span>`;
        
        container.style.opacity = '1';
        container.style.transform = 'translateY(0)';
      }, 400);
      
      currentFact = fact;
    }
    
    // New fact button
    document.getElementById('new-fact-btn').addEventListener('click', () => {
      let newFact;
      do {
        newFact = facts[Math.floor(Math.random() * facts.length)];
      } while (newFact.id === currentFact.id && facts.length > 1);
      updateFact(newFact);
    });
    
    // Spacebar shortcut
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && e.target === document.body) {
        e.preventDefault();
        document.getElementById('new-fact-btn').click();
      }
    });
    
    // Share button
    document.getElementById('share-btn').addEventListener('click', async () => {
      const shareUrl = `${window.location.origin}/fact/${currentFact.id}`;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'Lobster Facts ðŸ¦ž',
            text: currentFact.text,
            url: shareUrl
          });
        } catch (err) {
          copyToClipboard(shareUrl);
        }
      } else {
        copyToClipboard(shareUrl);
      }
    });
    
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('share-btn');
        const original = btn.textContent;
        btn.textContent = 'âœ“ Link Copied!';
        setTimeout(() => { btn.textContent = original; }, 2000);
      });
    }
  </script>
  
  <style>
    #fact-container {
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
  </style>
</Layout>
